<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sign In / Sign Up</title>
  <style>
    /* --- same CSS as your code above --- */
    .popup {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--panel-2);
      border: 1px solid rgba(255,255,255,0.15);
      color: var(--danger);
      padding: 14px 18px;
      border-radius: 12px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.4);
      font-weight: 600;
      animation: slideIn .4s ease;
      z-index: 1000;
    }
    @keyframes slideIn{
      from{transform:translateY(-20px);opacity:0}
      to{transform:translateY(0);opacity:1}
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="header">
      <div class="brand">üîê Auth Demo</div>
      <div class="tabs">
        <button class="tab active" id="tab-signin" type="button">Sign In</button>
        <button class="tab" id="tab-signup" type="button">Sign Up</button>
      </div>
    </div>
    <div class="content">

      <!-- Sign In -->
      <section class="panel" id="panel-signin">
        <h2>Sign In</h2>
        <form id="form-signin" method="post" action="login.servlet">
          <div>
            <label for="uid">UID</label>
            <input id="uid" name="uid" type="text" placeholder="Enter UID" required />
          </div>
          <div class="actions">
            <button class="btn" type="submit">Sign In</button>
          </div>
        </form>
      </section>

      <!-- Sign Up -->
      <section class="panel hidden" id="panel-signup">
        <h2>Create your account</h2>
        <form id="form-signup" enctype="multipart/form-data">
          <div class="row">
            <div>
              <label for="firstName">First Name</label>
              <input id="firstName" name="firstName" type="text" required />
            </div>
            <div>
              <label for="lastName">Last Name</label>
              <input id="lastName" name="lastName" type="text" required />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="phone">Phone</label>
              <input id="phone" name="phone" type="tel" maxlength="10" required />
            </div>
            <div>
              <label for="email">Email</label>
              <input id="email" name="email" type="email" required />
            </div>
          </div>
          <div>
            <label for="photo">Profile Picture</label>
            <input id="photo" name="photo" type="file" accept="image/*" />
            <div class="preview">
              <img id="avatar" class="avatar" alt="preview" />
              <span id="photo-name" class="note">No image selected</span>
            </div>
          </div>
          <div class="actions">
            <button class="btn" id="btn-register" type="submit">Register</button>

            <!-- Google button -->
            <div id="g_id_onload"
                 data-client_id="705482215484-kl0vro5evrhissbe9vrl90s0gfjd8bm5.apps.googleusercontent.com"
                 data-context="signup"
                 data-ux_mode="popup"
                 data-callback="handleGoogleSignIn"
                 data-auto_prompt="false">
            </div>
            <div class="g_id_signin"
                 data-type="standard"
                 data-size="large"
                 data-theme="outline"
                 data-text="signup_with"
                 data-shape="rectangular"
                 data-logo_alignment="left">
            </div>

            <div id="signup-msg" class="ok"></div>
          </div>
        </form>
      </section>
    </div>
  </div>

  <!-- Google Identity -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script>
    // Tabs
    const tabSignin=document.getElementById('tab-signin');
    const tabSignup=document.getElementById('tab-signup');
    const panelSignin=document.getElementById('panel-signin');
    const panelSignup=document.getElementById('panel-signup');
    tabSignin.onclick=()=>{tabSignin.classList.add('active');tabSignup.classList.remove('active');panelSignin.classList.remove('hidden');panelSignup.classList.add('hidden');}
    tabSignup.onclick=()=>{tabSignup.classList.add('active');tabSignin.classList.remove('active');panelSignup.classList.remove('hidden');panelSignin.classList.add('hidden');}

    // Image Preview (manual upload)
    document.getElementById('photo').addEventListener('change', e=>{
      const file=e.target.files[0];
      if(file){
        document.getElementById('avatar').src=URL.createObjectURL(file);
        document.getElementById('photo-name').textContent=file.name;
      }
    });

    // Google callback
    function handleGoogleSignIn(response){
      const data=parseJwt(response.credential);
      document.getElementById('firstName').value=data.given_name||'';
      document.getElementById('lastName').value=data.family_name||'';
      document.getElementById('email').value=data.email||'';
      document.getElementById('avatar').src=data.picture||'';
      document.getElementById('photo-name').textContent="From Google";
      document.getElementById('signup-msg').textContent="Google user auto-filled ‚úî";
    }
    function parseJwt(token){
      const base64Url=token.split('.')[1];
      const base64=base64Url.replace(/-/g,'+').replace(/_/g,'/');
      const jsonPayload=decodeURIComponent(atob(base64).split('').map(c=>{
        return '%'+('00'+c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      return JSON.parse(jsonPayload);
    }

    // Form Submit -> register.servlet
    document.getElementById('form-signup').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const formData=new FormData(e.target);
      try{
        const res=await fetch("register.servlet",{method:"POST",body:formData});
        const text=await res.text();
        if(text.includes("DUPLICATE")){
          showPopup("‚ö† User already registered. Try another Gmail / Phone.");
        }else{
          showPopup("‚úÖ Registered successfully!");
          e.target.reset();
          document.getElementById('avatar').src="";
          document.getElementById('photo-name').textContent="No image selected";
        }
      }catch(err){
        showPopup("‚ùå Error connecting to server");
      }
    });

    function showPopup(msg){
      const p=document.createElement("div");
      p.className="popup";
      p.textContent=msg;
      document.body.appendChild(p);
      setTimeout(()=>p.remove(),3000);
    }
  </script>
</body>
  </html>
